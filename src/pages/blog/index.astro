---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}
---

<Base title="Blog">
  <main class="blog-index">
    <header class="blog-index__header">
      <a href="/homepage" class="blog-index__back">&larr; home</a>
      <h1 class="blog-index__title">Writing</h1>
    </header>

    {posts.length === 0 ? (
      <p>No posts yet.</p>
    ) : (
      <ul class="blog-index__list">
        {posts.map((post) => (
          <li class="blog-index__item">
            <a href={`/homepage/blog/${post.slug}`} class="blog-index__link">
              <span class="blog-index__post-title">{post.data.title}</span>
              <time class="blog-index__date" datetime={post.data.date.toISOString()}>
                {formatDate(post.data.date)}
              </time>
            </a>
          </li>
        ))}
      </ul>
    )}
  </main>
</Base>
